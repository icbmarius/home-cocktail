<%- include("partials/head", { title: "Admin Dashboard" }) %>

<section class="page-head">
  <div>
    <p class="eyebrow">Admin</p>
    <h1>Panou Cocktails</h1>
  </div>
  <form method="POST" action="/admin/logout">
    <button class="btn btn-small btn-secondary" type="submit">Logout</button>
  </form>
</section>

<section class="card">
  <h2>Adauga cocktail</h2>

  <% if (error) { %>
    <p class="alert"><%= error %></p>
  <% } %>

  <% if (success) { %>
    <p class="success"><%= success %></p>
  <% } %>

  <form class="form" method="POST" action="/admin/cocktails" enctype="multipart/form-data">
    <label>
      Nume cocktail *
      <input type="text" name="name" required />
    </label>

    <label>
      Ce contine *
      <textarea name="ingredients" rows="4" required></textarea>
    </label>

    <label>
      Poza preparat (optional)
      <input type="file" name="image" accept="image/*" />
    </label>

    <button class="btn" type="submit">Salveaza</button>
  </form>
</section>

<section class="card">
  <h2>Lista cocktail-uri</h2>
  <% if (!cocktails.length) { %>
    <p>Nu exista cocktail-uri inca.</p>
  <% } %>

  <% cocktails.forEach((item) => { %>
    <div class="admin-item">
      <div>
        <strong><%= item.name %></strong>
        <p class="muted multiline"><%= item.ingredients %></p>
        <p class="muted"><%= item.created_at %></p>
      </div>
      <div class="row-actions">
        <% if (item.image_path) { %>
          <a class="btn btn-small btn-secondary" href="<%= item.image_path %>" target="_blank" rel="noreferrer">Vezi poza</a>
        <% } %>
        <a class="btn btn-small btn-secondary" href="/admin?edit_id=<%= item.id %>">Editeaza</a>
        <form method="POST" action="/admin/cocktails/<%= item.id %>/delete">
          <button class="btn btn-small danger" type="submit">Sterge</button>
        </form>
      </div>
    </div>
  <% }) %>
</section>

<% if (editCocktail) { %>
  <section class="card">
    <h2>Editeaza cocktail</h2>
    <form class="form" method="POST" action="/admin/cocktails/<%= editCocktail.id %>/update" enctype="multipart/form-data">
      <label>
        Nume cocktail *
        <input type="text" name="name" required value="<%= editCocktail.name %>" />
      </label>

      <label>
        Descriere / Ce contine *
        <textarea name="ingredients" rows="4" required><%= editCocktail.ingredients %></textarea>
      </label>

      <% if (editCocktail.image_path) { %>
        <p class="muted">
          Poza actuala:
          <a href="<%= editCocktail.image_path %>" target="_blank" rel="noreferrer">deschide</a>
        </p>
      <% } %>

      <label>
        Schimba poza (optional)
        <input type="file" name="image" accept="image/*" />
      </label>

      <div class="row-actions">
        <button class="btn" type="submit">Salveaza modificarile</button>
        <a class="btn btn-secondary" href="/admin">Anuleaza</a>
      </div>
    </form>
  </section>
<% } %>

<section class="card">
  <h2>Comenzi primite</h2>
  <% if (!orders.length) { %>
    <p>Nicio comanda inca.</p>
  <% } %>

  <% orders.forEach((order) => { %>
    <div class="admin-item">
      <div>
        <strong><%= order.customer_name %></strong>
        <p><%= order.cocktail_name %></p>
        <% if (order.note) { %><p class="muted"><%= order.note %></p><% } %>
        <p class="muted"><%= order.created_at %></p>
      </div>
      <div class="row-actions">
        <form method="POST" action="/admin/orders/<%= order.id %>/delete">
          <button class="btn btn-small danger" type="submit">Sterge</button>
        </form>
      </div>
    </div>
  <% }) %>
</section>

<%- include("partials/foot") %>
